<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>みりますRTB計算</title>
</head>
<body>
<!--日付変更にmomentjisを使用、ろーかるで動かすにはhttp://momentjs.com/　が必要-->
<script type="text/javascript" src="./LIB/moment-with-langs.js"></script>
<script type="text/javascript">
<!--
	var RTBs = function () {
		this.t="";
		this.a = 0;
		this.b = 0;
		this.c = 0;
		this.d = 0;
		this.e = 0;
	};
	
	
	function stringfilter(text){
	
	var RTB = [];//１日分なら配列1500ぐらい,いべ最大13日*24時間*60分=配列18720,dt　int5が8+4*5とするとMAXで524,160+TXT分
	var rt= document.trg.event.options[document.trg.event.selectedIndex].text;
	var tf=document.tt.time.options[document.tt.time.selectedIndex].text;
	
	if(tf==null){
	tf="YYYY/MM/DD HH:mm"
	}
	
	if(document.trg.event.selectedIndex>0){
	text=text.replace(new RegExp(rt, 'g'), "XX:XX");
	}
	
	//泥の標準ぶらうざだと改行ぬけるので対策
	text=text.replace(new RegExp("[ 　\t]+pt ","gm")," pt\n");
	
	var lf = text.split("\n");
	var str ="";
	var st="";
	var btmp=[0,0,0,0,0];
	var head=new Array("1位","100位","1200位","3000位","自速");
	
    regrank = new RegExp("(1|[0-9]+0)位[ 　\t]+([0-9]+(,[0-9]{3})*)[ 　\t]+pt");
    regownpace = new RegExp(".*?pt[ 　\t]+([0-9]+(,[0-9]{3})*)[ 　\t]+pt");
    rgr = new RegExp("([0-9]+0?位.*?\n)+※");
    regdt = new RegExp("※([0-9]{2}/[0-9]{2}).*?([0-9]{2}:[0-9]{2}) 集計時点");
    var k=0,t=-4;
	
	var matches = text.match(rgr);
	if(matches !=null){
	//なんとか位を拾う
	var mm=matches[0].match(/[0-9]+位/gm)
	for(var i=0;i<mm.length;i++){
	head[i]=mm[i];
	if(i==3){ break;}
	}
	}

for( var i = 0 , l = lf.length; i < l ; i++ ){
 		str= lf[i];
		if(str.match(regrank)){
		var xx = str.match(regrank);
		if(t<0){
		btmp[t+4]=rmc(xx[2]);
		t++;
		}
		}
		else if(str.match(regownpace)){
		var xx = str.match(regownpace);
		btmp[4]=rmc(xx[1]);
		}
		else if(str.match(regdt)){
		var xx = str.match(regdt);
		
		 RTB[k] = new RTBs();
		 RTB[k].t= tmcv("2014/"+xx[1]+" "+xx[2],tf);
		 RTB[k].a=btmp[0];
		 RTB[k].b=btmp[1];
		 RTB[k].c=btmp[2];
		 RTB[k].d=btmp[3];
		 RTB[k].e=btmp[4];
		 k++;
		 t=-4;
		}
		else{
		 t=-4;
		}
}
	

	var ch=[];
	var l = RTB.length-1;
	for(var i=0;i<5;i++){
	ch[i]=document.chbox.elements[i].checked;
	}
	
	
	if(ch[4]){
	st= "\n"+ st + head[4] +"\n";
	for( var i = 0 ; i < l ; i++ ){
	if(RTB[i+1].t!=""){
	 st = st + RTB[i+1].t +" " + RTB[i+1].e + "(+" + (RTB[i+1].e-RTB[i].e) + ")\n";
	 }
	}
	}
	
	if(ch[3]){
	st= "\n"+ st + head[3] +"\n";
	for( var i = 0 ; i < l ; i++ ){
	if(RTB[i+1].t!=""){
	 st = st + RTB[i+1].t +" " + RTB[i+1].d + "(+" + (RTB[i+1].d-RTB[i].d) + ")\n";
	 }
	}
	}
	
	if(ch[2]){
	st= "\n"+st + head[2] +"\n";
	for( var i = 0 ; i < l ; i++ ){
	if(RTB[i+1].t!=""){
	 st = st + RTB[i+1].t +" " + RTB[i+1].c + "(+" + (RTB[i+1].c-RTB[i].c) + ")\n";
	 }
	}
	}
	if(ch[1]){
	st= "\n"+st + head[1] +"\n";
	for( var i = 0 ;i < l ; i++ ){
	if(RTB[i+1].t!=""){
	 st = st + RTB[i+1].t +" " + RTB[i+1].b + "(+" + (RTB[i+1].b-RTB[i].b) + ")\n";
	 }
	}
	}
	if(ch[0]){
	st= "\n"+st + head[0] +"\n";
	for( var i = 0 ; i < l ; i++ ){
	if(RTB[i+1].t!=""){
	 st = st + RTB[i+1].t +" " + RTB[i+1].a + "(+" + (RTB[i+1].a-RTB[i].a) + ")\n";
	 }
	}
	}
	
	document.cvcode.elements[0].value = st;
	return false;
	}

	function rmc(a){
	return parseInt(a.replace(new RegExp(",", 'g'), ""));
	}
	
	function tmcv(dt,tf){
	var m = moment(dt,"YYYY/MM/DD HH:mm");
	if(tf.indexOf("Ｈ")>0){
	tf=tf.replace("Ｈ","YY");
	//m.add('years', -1988);
	
	//http://bizmakoto.jp/bizid/articles/0709/18/news046.html
	//2000年以上限定、1988=2000-12なので2087まで使える？
	m.add('years', 12);
	}
	return m.format(tf);
	}
-->
</script>

<p>いべとっぷのぼだすこあ部分を貼り付け<br>
ぼだ：「個人ランキング獲得ポイント～集計時点のポイント」　まで<br>
自速:「個人ステータス～集計時点の順位」　まで<br>
</p>
<form name="chbox">
//出力対象<br>
<input type="checkbox" value="S1">ランク１<br>
<input type="checkbox" value="S2">ランク２<br>
<input type="checkbox" value="S3">ランク３<br>
<input type="checkbox" value="S4">ランク４<br>
<input type="checkbox" value="OWN">自速
</form>
<form name="tt">
//日付時刻表記<br>
<select name="time">
<option value="">YYYY/MM/DD HH:mm</option>
<option value="">YYYY-MM-DD HH:mm</option>
<option value="">YYYY年MM月DD日 HH時mm分</option>
<option value="">YY/MM/DD HH:mm</option>
<option value="">YY-MM-DD HH:mm</option>
<option value="">YY年MM月DD日 HH時mm分</option>
<option value="">[H]Ｈ年MM月DD日 HH時mm分</option>
<option value="">平成Ｈ年MM月DD日 HH時mm分</option>
<option value="">MM/DD/YYYY HH:mm</option>
<option value="">MM-DD-YYYY HH:mm</option>
<option value="">MM/DD/YY HH:mm</option>
<option value="">MM/DD/Ｈ HH:mm</option>
<option value="">MM-DD-YY HH:mm</option>
<option value="">MM-DD-Ｈ HH:mm</option>
<option value="">MM/DD HH:mm</option>
<option value="">MM-DD HH:mm</option>
<option value="">MM月DD日 HH時mm分</option>
<option value="">HH:mm</option>
</select><br>
</form>
<form name="trg">
//時刻正規<br>
<select name="event">
<option value=""></option>
<option value="">(※5分毎)?[0-9]{2}:[0-5][1-46-9]</option>
<option value="">(※10分毎)?[0-9]{2}:[0-5][1-9]</option>
<option value="">(※20分毎)?[0-9]{2}:([135][0-9]|[024][1-9])</option>
<option value="">(※30分毎)?[0-9]{2}:([1245][0-9]|[03][1-9])</option>
<option value="">(※1時間毎)?[0-9]{2}:(0[1-9]|[1-5][0-9])</option>
<option value="">(※24時間毎,17時起点)?((0[0-9]|1[0-689]|2[0-4]):[0-9][0-9]|17:([1-9][0-9]|0[1-9]))</option>
<option value="">(※24時間毎,0時起点)?((0[1-9]|1[0-9]|2[0-4]):[0-9][0-9]|00:([1-9][0-9]|0[1-9]))</option>
</select>
</form><br>
<form name="rtbcode">
<textarea name="text" rows="10" cols="50"></textarea><br>
<input type="Submit" value="Convert" Generate" onclick="stringfilter(document.rtbcode.text.value);return false">
<input type="reset" value="Clear">
</form>
<form name="cvcode">
<textarea name="text" rows="10" cols="50"></textarea>
</form>
<p>
更新履歴<br>
2014/04/21<br>
あんどろいど全般のぶらうざが改行ぬけるっぽいので対策<br>
てーぶるろう〆&lt;/tr&gt;が改行にされないぽい？<br>
2014/04/20<br>
個人ステータ下の自速計算に対応<br>
日付出力に平成を追加<br>
2014/04/19<br>
動作確認済ブラウザりすとを追加<br>
2014/04/17<br>
日付変更を追加、らいぶらりmoment.jsを使用<br>
NETAで作成、C#→JSに移植しただけ<br>
過去いべでたなら<a href="http://millionlive-border-records.googlecode.com/">SVN</a>に存在<br>
by(ﾟ∀ﾟ)えれな道場</p>

//動作確認済ブラウザ//<br>
PC:IE10,FIREFOX,CHROME<br>
iOS:SAFARI<br>
ANDROID:CHROME,改行抜け対策済み(BROWSERetc)<br>
</body>
</html>